!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Gob=e()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},n={isEmptyObject:function(t){for(var e in t)return!1;return!0},objectCopyToObject:function(t,e,o,n,c,a){if(void 0!=e)for(var i in t){void 0!=a&&a(t,e,i);void 0!=o&&o(i,t[i]);var u=i;void 0!=n&&(u=n(i,t[i])),void 0!=t[i]&&t[i].constructor===Object?("object"!==r(e[u])&&(e[u]={}),this.objectCopyToObject(t[i],e[u],o,n,c)):e[u]=void 0!=c?c(i,t[i]):t[i]}},getObjectValueByNames:function(t,e,r){for(var o,n=0;n<e.length-(r||0);n++)if(0==n){if(void 0==t[e[n]])return;o=t[e[n]]}else{if(void 0==o[e[n]])return;o=o[e[n]]}return o},setObjectValueByNames:function(t,e,r){var o;if(1!=e.length){for(var n=0;n<e.length;n++)if(0==n&&e.length>2)void 0==t[e[0]]&&(t[e[0]]={}),o=t[e[0]];else if(n<e.length-2&&e.length>2)void 0==o[e[n]]&&(o[e[n]]={}),o=o[e[n]];else if(n==e.length-2)return 2==e.length?(void 0==t[e[0]]&&(t[e[0]]={}),void((o=t[e[0]])[e[1]]=r)):(void 0==o[e[n]]&&(o[e[n]]={}),void((o=o[e[n]])[e[n+1]]=r))}else t[e[0]]=r},treeFind:function(t,e,r,o,n){if("function"==typeof e)var c=e;else c=function(t){return t.id==e};var a=function t(e,r,o,n,a){for(var i=[],u=[],f=0;f<e.length;f++){var l=e[f];if(c(l)&&(i.push(l),!n))return i;if(l[o])if(a){var s=t(l[o],r,o,n,a);if(!n&&s.length>0)return s;i=i.concat(s)}else u.push(l[o])}if(!a)for(f=0;f<u.length;f++){if(s=t(u[f],r,o,n,a),!n&&s.length>0)return s;i=i.concat(s)}return i}(t,c,r,o,n);return o?a:a.length>0?a[0]:null},treeEach:function(t,e,r,o){var n=[],c=0,a=0;return e||(e=function(t){}),function t(e,r,o,i,u){u>a&&(a=u);var f=[];for(var l=0;l<e.length;l++){c++,void 0==n[u]?n[u]=1:n[u]++;var s=e[l];if(r(s,u,n[u],c,e,l))return;if(s[o])if(i){var y=t(s[o],r,o,i,u+1);if(y)return}else f.push(s[o])}if(!i)for(var l=0;l<f.length;l++){var y=t(f[l],r,o,i,u+1);if(y)return}return}(t,e,r,o,0),{struct:n,deep:a+1,total:c}},pathEach:function(t,e,n){if(n){var c="function"==typeof n,a=new WeakMap;a.set(t,!c||[])}!function t(i){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];var f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(var l in i){var s=i[l];if(n&&"object"===(void 0===s?"undefined":r(s))){var y=[].concat(o(u),[l]);if(a.get(s)){c&&n(s,y,a.get(s));continue}c?a.set(s,y):a.set(s,!0)}var y=[].concat(o(u),[l]);e(s,y,f),"object"===(void 0===s?"undefined":r(s))&&t(s,y,f+1)}}(t,[],0)}},c={getType:function(t){var e={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object","[object Error]":"error"};return null===t?"null":void 0===t?"undefined":"object"===(void 0===t?"undefined":r(t))||"function"==typeof t?e[e.toString.call(t)]||"object":void 0===t?"undefined":r(t)}};function a(t,e){return t(e={exports:{}},e.exports),e.exports}a(function(t){var e="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(e){var r=new Uint8Array(16);t.exports=function(){return e(r),r}}else{var o=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),o[e]=t>>>((3&e)<<3)&255;return o}}});for(var i=[],u=0;u<256;++u)i[u]=(u+256).toString(16).substr(1);var f=a(function(t,e){var r=Object.prototype.hasOwnProperty,o=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}();e.arrayToObject=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},o=0;o<t.length;++o)void 0!==t[o]&&(r[o]=t[o]);return r},e.merge=function(t,o,n){if(!o)return t;if("object"!=typeof o){if(Array.isArray(t))t.push(o);else{if("object"!=typeof t)return[t,o];(n.plainObjects||n.allowPrototypes||!r.call(Object.prototype,o))&&(t[o]=!0)}return t}if("object"!=typeof t)return[t].concat(o);var c=t;return Array.isArray(t)&&!Array.isArray(o)&&(c=e.arrayToObject(t,n)),Array.isArray(t)&&Array.isArray(o)?(o.forEach(function(o,c){r.call(t,c)?t[c]&&"object"==typeof t[c]?t[c]=e.merge(t[c],o,n):t.push(o):t[c]=o}),t):Object.keys(o).reduce(function(t,c){var a=o[c];return r.call(t,c)?t[c]=e.merge(t[c],a,n):t[c]=a,t},c)},e.assign=function(t,e){return Object.keys(e).reduce(function(t,r){return t[r]=e[r],t},t)},e.decode=function(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}},e.encode=function(t){if(0===t.length)return t;for(var e="string"==typeof t?t:String(t),r="",n=0;n<e.length;++n){var c=e.charCodeAt(n);45===c||46===c||95===c||126===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122?r+=e.charAt(n):c<128?r+=o[c]:c<2048?r+=o[192|c>>6]+o[128|63&c]:c<55296||c>=57344?r+=o[224|c>>12]+o[128|c>>6&63]+o[128|63&c]:(n+=1,c=65536+((1023&c)<<10|1023&e.charCodeAt(n)),r+=o[240|c>>18]+o[128|c>>12&63]+o[128|c>>6&63]+o[128|63&c])}return r},e.compact=function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],o=0;o<e.length;++o)for(var n=e[o],c=n.obj[n.prop],a=Object.keys(c),i=0;i<a.length;++i){var u=a[i],f=c[u];"object"==typeof f&&null!==f&&-1===r.indexOf(f)&&(e.push({obj:c,prop:u}),r.push(f))}return function(t){for(var e;t.length;){var r=t.pop();if(e=r.obj[r.prop],Array.isArray(e)){for(var o=[],n=0;n<e.length;++n)void 0!==e[n]&&o.push(e[n]);r.obj[r.prop]=o}}return e}(e)},e.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},e.isBuffer=function(t){return null!==t&&void 0!==t&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}}),l=(f.arrayToObject,f.merge,f.assign,f.decode,f.encode,f.compact,f.isRegExp,f.isBuffer,Date.prototype.toISOString,f.encode,f.decode,"[PROXY]");var s="[Gob Core]",y=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isGob=3,this.data={},this.gate={}};function p(r){var o=new y,a=new Proxy(o.data,function r(o,a,i,u){return{set:function(f,s,y){if(s==u.GOB_CORE_NAME)return!0;var p=e(i).concat([s]);if(console.log("[set]","fullPath:",p,{key:s,target:f,value:y}),"object"===c.getType(y)){var b=function(t,e,o){console.log("  [creatGate] key:",s,"fullPath",p,{targetPath:e,localGate:a});var c={},i=new Proxy(t,r(t,c,o,u));return c[l]=i,n.setObjectValueByNames(a,e,c),c};o[s]=y,b(y,[s],p),n.pathEach(y,function(r,o){"object"===t(r)&&b(r,[s].concat(e(o)),e(p).concat(e(o)))},function(t,r,o){var c;console.log("  [cycle]",t,r,o),c=0==o.length?a[s]:n.getObjectValueByNames(a,[s,o],null),console.log("  [cycle cycleObject]",c),n.setObjectValueByNames(a,[s].concat(e(r)),c)})}else o[s]=y;return!0},get:function(t,r){if(r==u.GOB_CORE_NAME)return u.gobCore;var n=[r],f=e(i).concat([r]),s=o[r];console.log("[get]",f,{loaclData:o,nowLocalPath:n,key:r,target:t});var y=c.getType(s);return console.log("  [get value]",s,y),"object"===y?(console.log("  [find gates]",f,{key:r,nowLocalPath:n,localGate:a}),a[r][l]):(console.log("  return value",s),s)}}}(o.data,o.gate,[],{coreData:o.data,coreGate:o.gate,gobCore:o,GOB_CORE_NAME:s}));if(a[s]=o,r)for(var i in r)a[i]=r[i];return a}return Object.assign(p,{KEY:s,GOB_CORE_NAME:s,inspect:function(t){if(t[s])return t[s];throw Error("Gob.inspect: param is not Gob3 Instance")}}),p});
